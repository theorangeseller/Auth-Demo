# Authentication Demo Application

A comprehensive web application for learning and demonstrating SAML, OAuth 2.0, and OpenID Connect authentication flows with Microsoft Azure AD.

## üéØ Purpose

This demo application helps developers and IT professionals understand different authentication protocols by providing:

- **Interactive URL Builders** - Generate authentication URLs with proper parameters
- **Live Authentication Flows** - Test real authentication scenarios
- **Token Inspection** - Decode and analyze JWT tokens and SAML assertions
- **Educational Content** - Learn through hands-on experience

## üöÄ Features

### OAuth 2.0 Support
- Authorization Code Flow (with PKCE)
- Implicit Flow (deprecated, for educational purposes)
- Hybrid Flows
- Comprehensive scope and parameter configuration
- Token introspection and validation

### OpenID Connect Support
- Identity layer on top of OAuth 2.0
- ID Token (JWT) generation and decoding
- Standard OIDC scopes (openid, profile, email)
- Claims configuration
- Nonce and state parameter handling

### SAML SSO Support
- SAML 2.0 protocol implementation
- Service Provider (SP) metadata generation
- Authentication request building
- Support for various Name ID formats
- Signature and encryption options

### General Features
- Modern, responsive UI with Tailwind CSS
- Real-time URL generation and validation
- Token copying and downloading capabilities
- Educational tooltips and documentation links
- Multiple authentication endpoint support (common, organizations, consumers, tenant-specific)

## üìã Prerequisites

Before running this application, ensure you have:

1. **Python 3.12+** installed
2. **Azure AD tenant** (can use free tier)
3. **App registration** in Azure AD with:
   - Client ID
   - Client Secret (for confidential client scenarios)
   - Configured redirect URIs
   - Appropriate API permissions

## üõ†Ô∏è Installation

### Quick Start (No Configuration Required)

1. **Clone the repository**
   ```bash
   git clone <repository-url>
   cd authapp-demo
   ```

2. **Install dependencies**
   ```bash
   uv sync
   ```

3. **Run the application**
   ```bash
   uv run python run.py
   # or directly:
   uv run python main.py
   ```

4. **Access the application**
   Open your browser and navigate to `http://localhost:3000`

### Azure AD Configuration (For Live Testing)

The application will start without any configuration. To test live authentication flows:

1. **Configure via Web Interface** (Recommended)
   - Click "Configure" in the navigation
   - Follow the on-screen instructions
   - Enter your Azure AD app registration details

2. **Configure via Environment Variables** (Optional)
   ```bash
   cp .env.example .env
   ```
   
   Edit `.env` with your Azure AD configuration:
   ```env
   TENANT_ID=your-tenant-id-here
   CLIENT_ID=your-client-id-here
   CLIENT_SECRET=your-client-secret-here
   REDIRECT_URI=http://localhost:3000/auth/callback
   SECRET_KEY=your-secret-key-here
   ```

### What Works Without Configuration

- URL builders for all authentication methods
- Parameter configuration and validation
- Educational content and flow documentation
- Token inspection tools (for manually provided tokens)

### What Requires Configuration

- Live authentication flows (OAuth 2.0, OIDC, SAML)
- Token generation and callback handling
- Real Azure AD integration

## üîß Azure AD Configuration

### 1. Create App Registration

1. Go to [Azure Portal](https://portal.azure.com) ‚Üí Azure Active Directory ‚Üí App registrations
2. Click "New registration"
3. Configure:
   - **Name**: AuthDemo App
   - **Supported account types**: Choose based on your needs
   - **Redirect URI**: `http://localhost:3000/auth/callback`

### 2. Configure Authentication

1. In your app registration, go to **Authentication**
2. Add redirect URIs:
   - `http://localhost:3000/auth/callback`
   - Add any additional URIs you plan to test
3. Configure platform settings as needed

### 3. Create Client Secret

1. Go to **Certificates & secrets**
2. Click "New client secret"
3. Copy the secret value (you won't see it again!)

### 4. Configure API Permissions

1. Go to **API permissions**
2. Add permissions:
   - Microsoft Graph ‚Üí Delegated permissions
   - Add: `User.Read`, `profile`, `openid`, `email`
3. Grant admin consent if required

### 5. For SAML Configuration

1. Go to **Single sign-on**
2. Select **SAML**
3. Use the metadata generated by this application

## üìö Usage Guide

### OAuth 2.0 Builder

1. Navigate to the OAuth 2.0 section
2. Configure your authentication parameters:
   - Select base URL type (common, organizations, consumers, or specific tenant)
   - Enter your Client ID and Redirect URI
   - Choose scopes and response type
   - Set optional parameters (state, nonce, prompt)
3. Click "Generate URL" to create the authorization URL
4. Test the flow by clicking "Test Flow"

### OpenID Connect Builder

1. Go to the OpenID Connect section
2. Configure OIDC-specific parameters:
   - Ensure "openid" scope is included (required)
   - Set nonce parameter (recommended)
   - Configure additional claims if needed
3. Generate and test the OIDC flow
4. Examine the ID token structure and claims

### SAML SSO Configuration

1. Access the SAML SSO section
2. Configure Identity Provider settings:
   - Enter your Azure AD tenant ID
   - Set application ID
3. Configure Service Provider settings:
   - Set Entity ID and ACS URL
   - Choose Name ID format and binding
4. Generate SP metadata and SAML requests
5. Download metadata for Azure AD configuration

## üîç Understanding the Flows

### OAuth 2.0 Authorization Code Flow

```
1. User ‚Üí SP: Access protected resource
2. SP ‚Üí Azure AD: Redirect with authorization request
3. Azure AD ‚Üí User: Authentication challenge
4. User ‚Üí Azure AD: Provide credentials
5. Azure AD ‚Üí SP: Authorization code
6. SP ‚Üí Azure AD: Exchange code for tokens
7. Azure AD ‚Üí SP: Access token (+ refresh token)
8. SP ‚Üí API: Use access token
```

### OpenID Connect Flow

```
1-6. [Same as OAuth 2.0]
7. Azure AD ‚Üí SP: ID token + Access token
8. SP: Validate ID token and extract user info
9. SP ‚Üí User: Authentication success
```

### SAML SSO Flow

```
1. User ‚Üí SP: Access protected resource
2. SP ‚Üí Azure AD: SAML AuthnRequest
3. Azure AD ‚Üí User: Authentication challenge
4. User ‚Üí Azure AD: Provide credentials
5. Azure AD ‚Üí SP: SAML Response with assertion
6. SP: Validate assertion and grant access
```

## üêõ Troubleshooting

### Common Issues

1. **"Invalid redirect URI"**
   - Ensure the redirect URI in your request exactly matches what's configured in Azure AD
   - Check for trailing slashes and case sensitivity

2. **"Invalid client"**
   - Verify your Client ID is correct
   - Ensure the app registration is in the correct tenant

3. **"Insufficient permissions"**
   - Check that required permissions are granted in Azure AD
   - Ensure admin consent is provided if required

4. **"Invalid scope"**
   - Verify the scopes you're requesting are configured in your app registration
   - For OIDC, ensure "openid" scope is included

### Debug Mode

Enable debug mode by setting `FLASK_DEBUG=True` in your environment to see detailed error messages.

## ü§ù Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Add tests if applicable
5. Submit a pull request

## üìÑ License

This project is licensed under the MIT License - see the LICENSE file for details.

## üîó Useful Links

- [Microsoft Identity Platform Documentation](https://docs.microsoft.com/en-us/azure/active-directory/develop/)
- [OAuth 2.0 Specification](https://tools.ietf.org/html/rfc6749)
- [OpenID Connect Specification](https://openid.net/connect/)
- [SAML 2.0 Specification](https://docs.oasis-open.org/security/saml/Post2.0/sstc-saml-tech-overview-2.0.html)

## ‚ö†Ô∏è Security Note

This application is designed for learning and demonstration purposes. In production environments:

- Use HTTPS for all communication
- Implement proper token storage and handling
- Follow security best practices for session management
- Regular security audits and updates
- Implement proper error handling without exposing sensitive information

## Azure Web App Deployment

This application is designed to be deployed on Azure Web Services, providing automatic HTTPS support and public accessibility required for Azure AD SAML integration.

### Benefits of Azure Web App Hosting

- **‚úÖ Automatic HTTPS:** SSL certificates managed by Azure platform
- **‚úÖ Public Accessibility:** Azure AD can reach callback URLs from the cloud
- **‚úÖ Custom Domains:** Use your own domain name if desired
- **‚úÖ Auto-scaling:** Handle varying loads automatically
- **‚úÖ Azure AD Integration:** Native support for Microsoft identity platform
- **‚úÖ CI/CD Pipeline:** Deploy directly from GitHub using Actions

### Deployment URL Structure

Once deployed to Azure Web Apps, your URLs will be:
- **Application URL:** `https://your-app-name.azurewebsites.net`
- **Reply URL:** `https://your-app-name.azurewebsites.net/auth/saml/callback`
- **Sign on URL:** `https://your-app-name.azurewebsites.net/saml/login`
- **Entity ID:** `https://your-app-name.azurewebsites.net/saml/metadata`

## GitHub Actions Deployment Setup

This repository includes automated deployment to Azure Web Apps using GitHub Actions.

üìñ **For detailed deployment instructions, see [DEPLOYMENT.md](DEPLOYMENT.md)**

### Prerequisites

1. **Azure Account:** You need an active Azure subscription
2. **GitHub Repository:** Fork or create a repository with this code
3. **Azure Web App:** Create an Azure Web App resource

### Step-by-Step Deployment

#### 1. Create Azure Web App

```bash
# Login to Azure CLI
az login

# Create resource group (if needed)
az group create --name authapp-demo-rg --location "East US"

# Create App Service Plan
az appservice plan create --name authapp-demo-plan --resource-group authapp-demo-rg --sku B1 --is-linux

# Create Web App
az webapp create --resource-group authapp-demo-rg --plan authapp-demo-plan --name your-unique-app-name --runtime "PYTHON|3.11"
```

#### 2. Get Publish Profile

```bash
# Download publish profile
az webapp deployment list-publishing-profiles --name your-unique-app-name --resource-group authapp-demo-rg --xml
```

#### 3. Configure GitHub Secrets

In your GitHub repository, go to **Settings > Secrets and variables > Actions** and add:

- `AZURE_WEBAPP_NAME`: Your Azure Web App name (e.g., `your-unique-app-name`)
- `AZURE_WEBAPP_PUBLISH_PROFILE`: The entire XML content from the publish profile

#### 4. Deploy

1. Push your code to the `main` branch
2. GitHub Actions will automatically build and deploy your application
3. Monitor the deployment in the **Actions** tab of your GitHub repository

#### 5. Configure Environment Variables in Azure

Set your Azure AD configuration in the Azure portal:

```bash
# Set environment variables
az webapp config appsettings set --resource-group authapp-demo-rg --name your-unique-app-name --settings \
    TENANT_ID="your-tenant-id" \
    CLIENT_ID="your-client-id" \
    CLIENT_SECRET="your-client-secret"
```

Or configure through the Azure portal:
- Go to your Web App > **Configuration** > **Application settings**
- Add the environment variables as needed

### Azure AD Enterprise Application Setup

1. Go to [Azure Portal > Enterprise Applications](https://portal.azure.com/#view/Microsoft_AAD_IAM/StartboardApplicationsMenuBlade/~/AppAppsPreview)
2. Click "New application" ‚Üí "Create your own application"
3. Name: "AuthDemo SAML App"
4. Select "Integrate any other application you don't find in the gallery"
5. Go to "Single sign-on" ‚Üí Select "SAML"
6. Configure Basic SAML Configuration with the URLs from the app

## Configuration

### Option 1: Web Interface (Recommended)
1. Start the app and go to http://localhost:3000
2. Click "Configure Azure AD" to set up your credentials
3. Enter your Tenant ID (and optionally Client ID/Secret for OAuth flows)

### Option 2: Environment Variables
Create a `.env` file in the project root:

```env
# Required for OAuth 2.0 and OIDC flows
TENANT_ID=your-tenant-id-here
CLIENT_ID=your-client-id-here
CLIENT_SECRET=your-client-secret-here

# Optional: Custom port (default: 3000)
PORT=3000
```

## Authentication Methods

### OAuth 2.0
- **Setup**: App Registration in Azure AD
- **Requirements**: Tenant ID, Client ID, Client Secret
- **Features**: Authorization code, implicit, and hybrid flows
- **URL Builder**: Interactive parameter configuration

### OpenID Connect (OIDC)
- **Setup**: App Registration in Azure AD (same as OAuth 2.0)
- **Requirements**: Tenant ID, Client ID, Client Secret
- **Features**: ID token inspection, claims viewing, nonce validation
- **Additional**: Profile and email scopes

### SAML SSO
- **Setup**: Enterprise Application in Azure AD
- **Requirements**: Tenant ID only (no client secret)
- **Features**: XML assertion viewing, Enterprise App configuration
- **HTTPS**: Automatically provided by Azure Web App deployment

## Development

### Project Structure
```
authapp-demo/
‚îú‚îÄ‚îÄ main.py              # Flask application
‚îú‚îÄ‚îÄ run.py               # Application runner
‚îú‚îÄ‚îÄ templates/           # HTML templates
‚îÇ   ‚îú‚îÄ‚îÄ base.html       # Base layout
‚îÇ   ‚îú‚îÄ‚îÄ index.html      # Home page
‚îÇ   ‚îú‚îÄ‚îÄ oauth2.html     # OAuth 2.0 builder
‚îÇ   ‚îú‚îÄ‚îÄ oidc.html       # OIDC configuration
‚îÇ   ‚îú‚îÄ‚îÄ saml.html       # SAML SSO setup
‚îÇ   ‚îî‚îÄ‚îÄ dashboard.html  # Results display
‚îî‚îÄ‚îÄ pyproject.toml      # Dependencies

```

### Key Dependencies
- **Flask**: Web framework
- **MSAL**: Microsoft Authentication Library
- **PyJWT**: JWT token handling
- **python-jose**: Token verification

## Usage Examples

### Testing OAuth 2.0 Flow
1. Configure your Azure AD App Registration
2. Set Tenant ID, Client ID, and Client Secret
3. Go to OAuth 2.0 page and build authorization URL
4. Test the flow and inspect tokens

### Testing SAML SSO
1. Deploy application to Azure Web App
2. Configure Azure AD Enterprise Application with your Azure Web App URLs
3. Set only Tenant ID in the app configuration
4. Test SAML flow and view assertion data

### Inspecting Tokens
- OAuth/OIDC: View JWT header, payload, and signature
- SAML: View XML assertion structure and claims
- Copy tokens for external validation tools

## Troubleshooting

### Common Issues

**"HTTPS required" error in Azure AD:**
- Deploy to Azure Web App for automatic HTTPS support
- Cannot use HTTP URLs with Azure AD SAML

**"Invalid redirect URI" error:**
- Ensure redirect URIs match exactly in Azure AD
- Include the port number: `http://localhost:3000/auth/callback`

**"Tenant not found" error:**
- Verify Tenant ID is correct
- Use Directory (tenant) ID from Azure AD overview

**Dependencies conflict:**
- Use `uv sync` instead of pip
- Some SAML packages may have conflicts (optional dependencies)

### Getting Help

- Check the browser console for JavaScript errors
- Review Flask logs in the terminal
- Verify Azure AD configuration matches the app URLs
- Ensure correct scopes and permissions in Azure AD

## Educational Resources

- [Microsoft Identity Platform Documentation](https://docs.microsoft.com/en-us/azure/active-directory/develop/)
- [OAuth 2.0 RFC](https://tools.ietf.org/html/rfc6749)
- [OpenID Connect Specification](https://openid.net/connect/)
- [SAML 2.0 Documentation](https://docs.oasis-open.org/security/saml/Post2.0/sstc-saml-tech-overview-2.0.html)

## Security Notes

This is a **demo application** for educational purposes:
- Use only for learning and testing
- Not intended for production use
- Store secrets securely in production environments
- Consider security implications of authentication flows

## License

This project is for educational purposes. Use responsibly and follow your organization's security policies.
